#!/usr/bin/env bash

set -eo pipefail

# Configure directories
build_dir=$1
cache_dir=$2
env_dir=$3

# Configure path for nodejs vendored by heroku-buildpack-nodejs
PATH=$build_dir/vendor/node/bin:$PATH

indent() {
  sed -u 's/^/       /'
}

echo "-----> Found an Ember CLI app"

# build app in dist directory
cd $1

if ! (which ember > /dev/null)
then
    echo "Installing ember-cli..." | indent
    npm install ember-cli
    echo "done" | indent
fi

ember build --environment production

echo "-----> Ember app build to dist/ directory"
