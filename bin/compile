#!/usr/bin/env bash

set -eo pipefail

# Configure directories
build_dir=$1
cache_dir=$2
env_dir=$3

# Configure path for nodejs vendored by heroku-buildpack-nodejs
PATH=$build_dir/vendor/node/bin:$PATH

indent() {
  sed -u 's/^/       /'
}

echo "-----> Found an Ember CLI app"

if ! (which ember > /dev/null)
then
  echo "-----> Installing ember-cli..."
  npm install --userconfig $build_dir/.npmrc -g ember-cli 2>&1 | indent
  echo "...done" | indent
fi

# build app in dist directory
cd $1
echo "-----> Building ember-cli app..."
ember build --environment production | indent
echo "...done" | indent

ls -l **/* | indent

echo "-----> Ember app build to dist/ directory"
